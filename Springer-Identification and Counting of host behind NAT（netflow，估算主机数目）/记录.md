# Abstract

识别隐藏在NAT后面传播恶意行为的主机对于取证调查是必要的。在本文中，我们提出了一种基于机器学习（ML）的算法来**识别和计算NAT背后的主机总数**。这是通过在网络流量中通过**流量级别的统计识别模式**和**检测主机的匿名性**来实现的。拟议工作的新颖之处在于**计算主机数目**，并将结果与**传统的基于签名的方法**进行比较，大大超过了基于签名的方法结果（约75%）。

此外，该模型还通过向其提供恶意网络流量数据集进行测试，以**识别和计算流量是来自于单个还是多个主机**。获得的较高准确率（约92.2%）反映了**该模型能够预测和计算正确的恶意主机数量**，且误报率最低。

我们通过在统计网**流记录**上应用基于ML的技术来识别和计算NAT背后的主机数量。所提出的方法的优点是，在捕获头的时候不会出现与**隐私**有关的问题。

# 简介

**动机**

这项工作的动机是开发一个ML模型，以识别NAT设备后面的主机（ identifies the hosts behind NAT device），并帮助计算它们（counting them）。

**NAT带来的挑战**

最大的问题是识别隐藏在NAT设备的公共接口后面的单个主机，每一次试图从广域网（WAN）找到攻击源，都会把他们引向网络网关（NAT）的公共接口，这就成为检测源的瓶颈。**在没有网络管理员的帮助下**，要进一步检测和找到确切的主机是**不可能**的。

**主机识别的需要**

ISP需要知道NAT后面的活跃用户的数量，以确保他们不跨越付费用户连接配额。

流媒体服务器，也需要主机计数以更好地服务其用户，在NAT用户的情况下，一个用户请求（隐藏大量的匿名用户）可能会用实时流协议（RTSP）请求压倒服务器。这可能会模仿DOS攻击，而用户数对于此类服务是至关重要的。

**论文贡献**

目前应用的传统的基于ML的方法是从网络流量中检测rouge NAT或NAT设备（is to detect rouge NAT or NAT device from network traffic）。

到目前为止，**尚未对主机进行计数**。本文提出了一种基于ML的算法来**识别和计算NAT后的主机总数**。这是通过**流级别统计来查找网络流量模式**，并**检测主机的匿名性**来实现的。所提出的工作的**新颖之处在于计算NAT背后的主机总数**，并将其结果**与基于签名的最先进方法进行比较**。

1. 使用提议的基于ML的方法**识别和计算隐藏在NAT后面的主机总数**。
2. 用恶意主机数据集来**计算恶意主机的数量**。这将有助于在检测到恶意流量的情况下，但我们不知道它是来自单个主机还是多个主机。
3. 与其他最先进的技术进行比较分析，以确定该模型的功效。

因此，当前工作的目标是开发一个ML模型，该模型可以**很容易地检测到NAT设备后面的主机（在私人局域网中），并帮助计算主机的总数**。这种模型的意义在于，根据网络流量的模式，**利用流量级别的统计数据，准确预测主机的匿名性。**（accurately predict the anonymity of hosts）

# 相关工作

主机识别技术--主机检测--主要可以通过两种方法实现，即主动探测或被动探测。

被动技术又被分为**基于签名**的方法和**基于ML**的方法。

基于签名的技术用于检测NAT后面的主机，就是要找到一组参数（签名），使得在没有IP地址的情况下**可以唯一地定义主机**。

- Cohen[7]提出了一个模型，使用不同协议字段之间的相关性来识别源机器；
- Maier等人[8]使用IP TTL和HTTP用户代理字符串来**估计连接到NAT设备的主机数量**；
- Mongkolluksamee等人[9]提出了一个被动方法来计算具有类似IP地址的主机，即NAT设备；
- Wicherski等人[10]提出了一个轻量级的实时灵活框架NATFILTERED，它使用**时间戳（TCP）来识别主机而不依赖于IP地址**；
- Paul等人[11]提出了一种**基于TCP SYN的方法来识别虚拟机**（VM）环境中使用的未授权操作系统的恶意活动；
- Park等人[12]提出了一种技术，使用**TCP/IP协议的头域来检测NAT背后的全部主机及其操作系统类型**。

表1详细显示了对基于ML的方法检测NAT和它背后的主机所做的文献调查。

- Abt建议使用从网流中提取的行为统计数据来检测rogueNAT设备。
- Komark等人[16]提议被动地利用HTTP访问日志中的IP特征来检测NAT行为。他们从HTTP日志中提取了所有独特的特征，如用户代理、操作系统及其版本、联系的IP地址、持续连接数、浏览器家族及其版本、发送的HTTP请求数、上传和下载的字节数等，用于分析和NAT识别。

# 建议的方法

目的是识别隐藏在NAT设备后面的**主机数量并对其进行统计**。然后我们对传统的基于签名的方法和基于ML的方法进行了比较分析。

我们想把我们的工作与类似的基于ML的方法进行比较，但**大多数论文（如表1所示）都是检测NAT而不计算主机**。对于提议的方法，我们在与八个多类分类器比较其性能后，使用了**决策树（DT）**分类器。对于基于签名的方法，我们已经根据文献[9, 10, 12]作为最先进的技术。

代表基本工作流程的方框图如图1所示，在 "建议的方法 "部分涉及的步骤如下。

1.	第一步是捕捉样本网络的网络流量。
2.	将该pcap文件输入**tranalyzer**应用程序，以**提取统计特征**。Tranalyzer默认有105个特征。
3.	接下来，我们应用**预处理和特征选择**方法来提取数据集中最重要的特征。
4.	测试不同的多类分类器，以找到最适合我们问题陈述的分类器。
5.	在选择分类器后，对数据集进行**训练**以建立测试模型。
6.	最后，**测试**数据集被用于获得模型的结果。

# 特征选择

数据集被转换为netflows。这是用Tranalyzer完成的，它将pcap文件转换为基于统计特征的流量，得到105个统计特征。

## 预处理

通过去除多余的特征和常量值来预处理我们的数据集。同时，以字符串格式出现的特征被转换成相应的整数值以保持每个特征的重要性。因此，这导致了47个特征的子集。

## 特征选择

我们的目的是在47个特征中**选择最优化的特征**，这些特征应该是独立于用户行为和网络环境的，以产生一个高效的数据模型，该模型应该足够强大，可以在不同的环境中工作。为此，我们使用了两种方法的组合：（1）过滤法和（2）包裹法。

第一种方法是过滤法，在包装法之前需要过滤，以使包装法的计算效率更高。图3显示了基于**信息增益值的所有特征的排名**，其中X轴显示了特征编号（47个特征中的每个都用数字表示），Y轴显示了信息增益值。正如我们从图3中观察到的，增益值在22个特征之后急剧下降。因此，我们选择了对我们模型影响最大的前22个特征。

在过滤方法之后，我们转向了包装方法。在包装方法中，我们专注于**遗传算法与单点交叉**，目的是为我们的问题找到最优化的特征集。

包装方法过程的方框图，该方法涉及的步骤如下。
1.	第一步，我们通过**过滤法得到初始特征集**。
2.	在第二步中，使用**交叉技术从过滤方法后留下的所有可用属性中选择一部分特征**。
3.	在第三步中，在通过交叉选择的**特征子集上实施ML算法**。
4.	在第四步，分析使用所选特征的算法的性能，**并重复第二步的过程，直到我们得到最佳的特征集**。

wrapper方法产生了一个由14个特征组成的子集，这对我们的问题陈述来说是最好的结果。因此，我们为这个问题选择了这14个特征，因为与47个特征相比，它**提高了模型的整体性能**。

# 建议的方法

使用ICS数据集来训练我们的模型，它包含了来自1116台主机的流量。我们通过源IP地址来识别每个主机，并将它们标记为一个独特的类别。一旦为每个流量分配了类别，我们就在ICS数据集的帮助下训练我们的模型。在训练完我们的数据模型后，我们使用了不同的数据集，其中包含来自多个主机的NAT- ted流量来测试我们的训练模型。然后，我们训练的模型在所有选定的特征的帮助下将每个流量分类到一个类别。然后**对独特的类别进行统计**，以**计算主机的数量**。

# 分类器的选择

由于有多个类别，所以选择多类分类器进行预测。接下来，八个多类ML分类器在具有14个特征集（从特征提取中获得）的ICS数据集上进行了比较，其中k-fold交叉验证（k=10）被应用。

表3列出了用于比较的分类器。

所有选择的分类器的性能分别用**精度、召回率和F1分数值**进行评估。因此，比较结果显示**决策树（DT）和随机森林（RF）分类器胜过其余分类器。**

# 实验结果

所使用的数据集表现较好，平均准确率为91%。
当ICS数据集被用于训练和测试时，我们得到了98%的平均准确率，这表明当用同一个数据集进行训练和测试时，它的表现要好很多。另一方面，LAB数据集的性能略有下降，如表4所示。这反映出，由于训练数据集（ICS数据集）与测试数据集（LAB数据集）不同。因此，如果训练和测试数据集不同，模型的性能就会降低。

此外，包含有恶意流量的MTA数据集仍被正确识别，以预测正确的主机数量。这意味着，如果恶意流量被送入我们的算法，它将确定恶意流量是来自单个主机还是多个主机（通过计算主机的总数）。

通过我们的代码实现的基于签名的方法（使用相同的数据集）的性能评估结果为75%（最大），与文献结果相似（大约）。在图6中，使用两种方法的准确性进行的比较性能评估清楚地表明，基于ML的拟议方法（蓝色）优于基于签名的方法。

以前的基准研究主要集中在NAT设备的检测上，而我们提出的框架则集中在NAT设备后面的主机上。

# 结论和未来工作

在本文中，我们描述了一种基于ML的技术，它是独立于操作系统的，通过分析统计网络流量来计算NAT后面的主机数量。三个不同的数据集被用来进行测试。通过Tranalyzer处理数据集来获得统计特征。应用预处理和特征选择方法，获得了14个最重要的特征。对不同的多类分类器进行了比较（基于它们的性能），发现决策树是它们中最好的。这样得到的结果显示出更好的结果，所有使用的数据集的平均性能为91%。

该模型在**计数恶意主机时也显示出良好的结果**，当输入恶意流量时。这将有助于确定恶意流量是否来自单一主机。
